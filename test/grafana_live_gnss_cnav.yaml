# Logger config for parsing records from gnsspo112593 on UDP port 53119
# and sending them to Grafana Live at http://ship-openrvdas-test:3000
#
# Generated by: local/sikuliaq/utils/generate_grafana_live_stream.py --grafana_url http://ship-openrvdas-test:3000 gnsspo112593
# API Source: https://coriolix.sikuliaq.alaska.edu/api
# Date: 2026-01-01T21:18:05.216798+00:00

readers:
  class: UDPReader
  kwargs:
    port: 53119
transforms:
- class: RegexTransform
  module: local.sikuliaq.coriolix.logger.transforms.regex_transform
  kwargs:
    record_format: '^(?P<data_id>\w+)\s*(?P<data_id_orig>[-\w]+)\s*(?P<timestamp>[0-9TZ:\-\.]*)\s*(?P<field_string>(.|\r|\n)*)'
    return_das_record: true
    field_patterns:
      GPZDA: '^\WGPZDA,(?P<utc_time>\d+\.\d+),(?P<day>\d{2}),(?P<month>\d{2}),(?P<year>\d{4}),(?P<tzoffset_hours>\d{0,2}),(?P<tzoffset_mins>\d{0,2})\*(?P<checksum>[0-9A-F]{2})$'
      GPGGA: '^\WGPGGA,(?P<utc_position_fix>\d+\.\d+),(?P<latitude>\d+\.\d+),(?P<latitude_dir>[NS]),(?P<longitude>\d+\.\d+),(?P<longitude_dir>[EW]),(?P<gps_quality_indicator>\d+),(?P<num_sat_vis>\d+),(?P<hdop>\d+\.\d+),(?P<ortho_height>\-?\d+\.\d+),M,(?P<geoid_separation>\-?\d+\.\d+),M,(?P<age>[\d\.]*)?,(\d{4})?\*(?P<checksum>[0-9A-F]{2})$'
      GPVTG: '^\WGPVTG,(?P<cog_true>\d+\.\d+)?,T,(?P<cog_magnetic>\d+\.\d+)?,M,(?P<sog_knots>\d+\.\d+)?,N,(?P<sog_kmhr>\d+\.\d+)?,K,?\w*\*(?P<checksum>[0-9A-F]{2})$'
      GPHDT: '^\WGPHDT,(?P<heading>\d+\.\d+),T\*(?P<checksum>[0-9A-F]{2})$'
- class: ConvertFieldsTransform
  module: logger.transforms.convert_fields_transform
  kwargs:
    delete_source_fields: true
    delete_unconverted_fields: true
    fields:
      cog_true: float
      geo_point: str
      gps_quality_indicator: int
      hdop: float
      heading: float
      sog_kmhr: float
      num_sat_vis: int
    lat_lon_fields:
      latitude: [latitude, latitude_dir]
      longitude: [longitude, longitude_dir]
writers:
- class: TextFileWriter
- class: GrafanaLiveWriter
  module: logger.writers.grafana_live_writer
  kwargs:
    host: http://ship-openrvdas-test:3000
    stream_id: openrvdas
    token_file: /opt/openrvdas/grafana_token.txt

